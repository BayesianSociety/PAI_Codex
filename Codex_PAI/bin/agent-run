#!/usr/bin/env bash
set -euo pipefail

ROOT="/home/postnl/PAI_Codex/Codex_PAI"

if [[ $# -lt 2 ]]; then
  echo "Usage: agent-run <AgentName> "task" [--search] [--model MODEL] [--cd DIR]"
  echo "Example: agent-run Engineer "Review scripts for bugs" --model gpt-5.3-codex"
  exit 1
fi

AGENT_NAME="$1"
TASK="$2"
shift 2 || true

AGENT_FILE="$ROOT/agents/${AGENT_NAME}.md"
if [[ ! -f "$AGENT_FILE" ]]; then
  echo "Missing agent file: $AGENT_FILE"
  exit 1
fi

PROMPT=$(cat <<PROMPT_EOF
Use this agent profile as authoritative behavior:

$(cat "$AGENT_FILE")

Now execute this task:
$TASK
PROMPT_EOF
)

exec "$ROOT/bin/codex-pai" exec "$PROMPT" "$@"
